<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>모의 주식 시뮬레이터</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
    .stock-info, .portfolio, .logs { margin-top: 20px; }
    .panel { margin-bottom: 10px; }
    textarea { width: 100%; height: 100px; }
    canvas { background: white; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>📈 모의 주식 시뮬레이터</h1>  <div class="panel">
    <label>종목 선택: 
      <select id="stockSelect"></select>
    </label>
    <button onclick="buyStock()">매수</button>
    <button onclick="sellStock()">매도</button>
    <button onclick="shortStock()">숏</button>
    <button onclick="coverShort()">청산</button>
    <button onclick="resetAllData()" style="background: red; color: white;">🗑️ 초기화</button>
  </div>  <div class="stock-info">
    <p>현재 자산: <span id="cash"></span>원</p>
    <p>현재 수익률: <span id="roi"></span>%</p>
  </div>  <div class="portfolio">
    <h3>보유 종목</h3>
    <ul id="portfolioList"></ul>
  </div>  <div class="logs">
    <h3>거래 기록</h3>
    <textarea id="logArea" readonly></textarea>
  </div>  <div>
    <canvas id="stockChart" width="600" height="300"></canvas>
  </div>  <script>
    let cash = 100000;
    let portfolio = {};
    let logs = [];
    let prices = JSON.parse(localStorage.getItem('prices')) || {
      삼성전자: 60000, 카카오: 70000, 네이버: 80000, LG화학: 90000, SK하이닉스: 100000
    };
    let initialPrices = { ...prices };
    let stocks = Object.entries(prices).map(([name, price]) => ({ name, price }));
    let currentStock = stocks[0].name;
    let chartsData = {};
    let chart;

    function saveAll() {
      localStorage.setItem('cash', cash);
      localStorage.setItem('portfolio', JSON.stringify(portfolio));
      localStorage.setItem('logs', JSON.stringify(logs));
      localStorage.setItem('prices', JSON.stringify(prices));
      localStorage.setItem('chartsData', JSON.stringify(chartsData));
    }

    function loadAll() {
      cash = Number(localStorage.getItem('cash')) || 100000;
      portfolio = JSON.parse(localStorage.getItem('portfolio')) || {};
      logs = JSON.parse(localStorage.getItem('logs')) || [];
      chartsData = JSON.parse(localStorage.getItem('chartsData')) || {};
    }

    function updatePrices() {
      for (let stock of stocks) {
        let change = stock.price * (Math.random() * 0.04 - 0.02);
        stock.price = Math.max(1000, stock.price + change);
        prices[stock.name] = Math.round(stock.price);

        if (!chartsData[stock.name]) chartsData[stock.name] = [];
        chartsData[stock.name].push(prices[stock.name]);
        if (chartsData[stock.name].length > 50) chartsData[stock.name].shift();
      }
      saveAll();
    }

    function renderChart(name) {
      const ctx = document.getElementById('stockChart').getContext('2d');
      const data = chartsData[name] || [];
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({ length: data.length }, (_, i) => i + 1),
          datasets: [{
            label: name,
            data: data,
            borderColor: 'blue',
            tension: 0.3,
            fill: false
          }]
        }
      });
    }

    function updateUI() {
      document.getElementById('cash').textContent = cash.toLocaleString();
      document.getElementById('portfolioList').innerHTML = Object.entries(portfolio).map(([name, { qty, short }]) => 
        `<li>${name}: ${qty || 0}주${short ? ` (숏: ${short.qty} @ ${short.price})` : ''}</li>`
      ).join('');
      const totalValue = Object.entries(portfolio).reduce((sum, [name, { qty = 0, short = null }]) => {
        return sum + (qty * prices[name]) - (short ? short.qty * (short.price - prices[name]) : 0);
      }, 0);
      const roi = (((cash + totalValue - 100000) / 100000) * 100).toFixed(2);
      document.getElementById('roi').textContent = roi;
      document.getElementById('stockSelect').innerHTML = stocks.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
    }

    function logAction(msg) {
      logs.push(`[${new Date().toLocaleTimeString()}] ${msg}`);
      document.getElementById('logArea').value = logs.join("\n");
    }

    function buyStock() {
      const name = document.getElementById('stockSelect').value;
      const price = prices[name];
      if (cash >= price) {
        cash -= price;
        portfolio[name] = portfolio[name] || { qty: 0 };
        portfolio[name].qty += 1;
        logAction(`${name} 1주 매수 (${price}원)`);
        saveAll();
        updateUI();
      }
    }

    function sellStock() {
      const name = document.getElementById('stockSelect').value;
      const price = prices[name];
      if (portfolio[name]?.qty > 0) {
        portfolio[name].qty -= 1;
        cash += price;
        logAction(`${name} 1주 매도 (${price}원)`);
        saveAll();
        updateUI();
      }
    }

    function shortStock() {
      const name = document.getElementById('stockSelect').value;
      const price = prices[name];
      portfolio[name] = portfolio[name] || {};
      portfolio[name].short = portfolio[name].short || { qty: 0, price: 0 };
      portfolio[name].short.qty += 1;
      portfolio[name].short.price = price;
      cash += price;
      logAction(`${name} 1주 숏 (${price}원)`);
      saveAll();
      updateUI();
    }

    function coverShort() {
      const name = document.getElementById('stockSelect').value;
      const price = prices[name];
      const short = portfolio[name]?.short;
      if (short && short.qty > 0) {
        portfolio[name].short.qty -= 1;
        cash -= price;
        const profit = short.price - price;
        cash += profit;
        logAction(`${name} 1주 청산 (${price}원, 수익: ${profit}원)`);
        saveAll();
        updateUI();
      }
    }

    function resetAllData() {
      if (confirm("정말로 모든 데이터를 초기화하시겠습니까? 이 작업은 되돌릴 수 없습니다.")) {
        localStorage.clear();
        cash = 100000;
        portfolio = {};
        logs = [];
        prices = structuredClone(initialPrices);
        stocks = Object.entries(prices).map(([name, price]) => ({ name, price }));
        chartsData = {};
        currentStock = stocks[0].name;
        updatePrices();
        renderChart(currentStock);
        updateUI();
        document.getElementById('logArea').value = "";
        alert("모든 데이터가 초기화되었습니다.");
      }
    }

    // 초기화
    loadAll();
    updatePrices();
    updateUI();
    setInterval(() => {
      updatePrices();
      updateUI();
      renderChart(document.getElementById('stockSelect').value);
    }, 3000);
  </script></body>
</html>
