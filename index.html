<!-- ì „ì²´ ì½”ë“œê°€ ê¸¸ì–´ ì¼ë¶€ëŸ¬ ìš”ì•½ëœ ë¶€ë¶„ ì—†ì´ ì „ì²´ ì œê³µ -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‹¤ì‹œê°„ ì£¼ì‹ ê±°ë˜ ì‹œë®¬ë ˆì´í„° - ë¡±/ìˆ í¬í•¨</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    body {
      display: flex;
      font-family: Arial, sans-serif;
      margin: 0;
      height: 100vh;
    }
    .sidebar {
      width: 200px;
      background: #f5f5f5;
      padding: 10px;
      overflow-y: auto;
      box-sizing: border-box;
    }
    .chart-container {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      box-sizing: border-box;
    }
    .stock-list button {
      display: block;
      width: 100%;
      margin-bottom: 5px;
    }
    .controls {
      margin-top: 10px;
    }
    .info {
      margin-top: 10px;
    }
    .log-table, .log-table th, .log-table td {
      border: 1px solid #ccc;
      border-collapse: collapse;
    }
    .log-table th, .log-table td {
      padding: 5px;
    }
    .rankings {
      margin-top: 20px;
      font-size: 14px;
    }
    .max-buy {
      margin-top: 5px;
      font-size: 14px;
      color: #333;
    }
    @media (max-height: 700px), (max-width: 480px) {
      body {
        flex-direction: column;
        height: 100vh;
      }
      .sidebar {
        width: 100%;
        height: 130px;
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
        padding: 5px 10px;
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        box-sizing: border-box;
      }
      .stock-list button {
        display: inline-block;
        width: auto;
        margin-right: 8px;
        margin-bottom: 0;
        white-space: normal;
        flex-shrink: 0;
      }
      .chart-container {
        height: calc(100vh - 130px);
        overflow-y: auto;
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2 style="flex-shrink: 0; margin-right: 15px;">ì¢…ëª© ì„ íƒ</h2>
    <div class="stock-list" id="stockButtons"></div>

    <div class="rankings">
      <h3>ğŸ† ìˆ˜ìµë¥  ìˆœìœ„</h3>
      <ul id="rankList"></ul>
    </div>

    <div style="margin-top:20px;">
      <label for="userNameInput">ì‚¬ìš©ì ì´ë¦„:</label><br />
      <input type="text" id="userNameInput" placeholder="ì´ë¦„ ì…ë ¥" />
      <button id="setNameBtn">ì„¤ì •</button>
    </div>
  </div>

  <div class="chart-container">
    <h1 id="stock-title">ì´ˆê¸°íˆ¬ì</h1>
    <div style="font-size: 18px; margin-bottom: 15px;">
      í˜„ì¬ ì£¼ê°€: <span id="currentPrice" style="font-weight: bold;">0</span>ì›
    </div>

    <div class="controls">
      <input type="number" id="tradeAmount" value="1" min="1" />
      <button onclick="buyStock()">ğŸŸ¢ ë§¤ìˆ˜</button>
      <button onclick="sellStock()">ğŸ”´ ë§¤ë„</button>
      <button onclick="longStock()">ğŸ“ˆ ë¡± ë§¤ìˆ˜</button>
      <button onclick="closeLong()">ğŸ“‰ ë¡± ì •ì‚°</button>
      <button onclick="shortStock()">ğŸ“‰ ìˆ ë§¤ë„</button>
      <button onclick="closeShort()">ğŸ“ˆ ìˆ ì •ì‚°</button>

      <div class="max-buy" id="maxBuy"></div>
      <div class="info">
        ğŸ’° ìê¸ˆ: <span id="cash">-</span>ì› |
        ğŸ’¼ ë³´ìœ  ìˆ˜ëŸ‰: <span id="shares">-</span>ê°œ<br />
        ğŸ“ˆ ì†ìµ: <span id="profit" style="font-weight: bold;">-</span>
      </div>
    </div>

    <canvas id="stockChart" width="1200" height="400"></canvas>

    <h3>ğŸ“‹ ê±°ë˜ ë‚´ì—­</h3>
    <table class="log-table" id="tradeLog">
      <thead>
        <tr>
          <th>ì‹œê°„</th>
          <th>ì¢…ëª©</th>
          <th>êµ¬ë¶„</th>
          <th>ë‹¨ê°€</th>
          <th>ìˆ˜ëŸ‰</th>
          <th>ì´ì•¡</th>
          <th>ì†ìµ</th>
          <th>ìˆ˜ìµë¥ </th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const initialCash = 100000; // âœ… ê¸°ì´ˆìê¸ˆ 10ë§Œì›
    const stocks = [...]; // ìƒëµ (ê¸°ì¡´ ì¢…ëª© ë°°ì—´ ìœ ì§€)
    const startPrices = {...}; // ìƒëµ
    const maxDataLength = 50;

    let currentUserName = null;
    let usersData = {};
    let currentStock = stocks[0];
    let stockData = {};
    let chart, data;
    let priceUpdateInterval = null;

    // â¬‡ï¸ ì—¬ê¸°ì— ìˆ/ë¡± ê´€ë ¨ í•¨ìˆ˜ë“¤ ì¶”ê°€:
    function longStock() {
      const user = getCurrentUserData();
      if (!user) return alert("ì‚¬ìš©ì ì´ë¦„ì„ ì„¤ì •í•˜ì„¸ìš”.");

      const amount = parseInt(document.getElementById('tradeAmount').value);
      const price = stockData[currentStock].at(-1);
      const cost = price * amount;
      if (user.cash < cost) return alert("ìê¸ˆ ë¶€ì¡±");

      user.cash -= cost;
      user.longs[currentStock] += amount;
      const prev = user.longs[currentStock] - amount;
      const prevAvg = user.longAvgPrice[currentStock] || 0;
      user.longAvgPrice[currentStock] = ((prevAvg * prev) + cost) / user.longs[currentStock];

      logTrade("ë¡± ë§¤ìˆ˜", price, amount, 0, 0);
      saveUsersData();
      updateInfo();
    }

    function closeLong() {
      const user = getCurrentUserData();
      if (!user) return;
      const amount = user.longs[currentStock];
      if (amount === 0) return alert("ë¡± í¬ì§€ì…˜ ì—†ìŒ");

      const price = stockData[currentStock].at(-1);
      const avg = user.longAvgPrice[currentStock];
      const gain = (price - avg) * amount;
      const rate = ((price - avg) / avg) * 100;

      user.cash += price * amount;
      user.longs[currentStock] = 0;
      user.longAvgPrice[currentStock] = null;

      logTrade("ë¡± ì •ì‚°", price, amount, gain, rate);
      saveUsersData();
      updateInfo();
    }

    function shortStock() {
      const user = getCurrentUserData();
      if (!user) return alert("ì‚¬ìš©ì ì´ë¦„ì„ ì„¤ì •í•˜ì„¸ìš”.");

      const amount = parseInt(document.getElementById('tradeAmount').value);
      const price = stockData[currentStock].at(-1);
      const margin = price * amount * 0.3; // ë§ˆì§„ 30%
      if (user.cash < margin) return alert("ì¦ê±°ê¸ˆ ë¶€ì¡±");

      user.cash -= margin;
      user.shorts[currentStock] += amount;
      const prev = user.shorts[currentStock] - amount;
      const prevAvg = user.shortAvgPrice[currentStock] || 0;
      user.shortAvgPrice[currentStock] = ((prevAvg * prev) + price * amount) / user.shorts[currentStock];

      logTrade("ìˆ ë§¤ë„", price, amount, 0, 0);
      saveUsersData();
      updateInfo();
    }

    function closeShort() {
      const user = getCurrentUserData();
      if (!user) return;
      const amount = user.shorts[currentStock];
      if (amount === 0) return alert("ìˆ í¬ì§€ì…˜ ì—†ìŒ");

      const price = stockData[currentStock].at(-1);
      const avg = user.shortAvgPrice[currentStock];
      const gain = (avg - price) * amount;
      const rate = ((avg - price) / avg) * 100;

      user.cash += (price * amount) + (avg * amount * 0.3); // ë˜ëŒë¦° ë§ˆì§„ + ì°¨ìµ
      user.shorts[currentStock] = 0;
      user.shortAvgPrice[currentStock] = null;

      logTrade("ìˆ ì •ì‚°", price, amount, gain, rate);
      saveUsersData();
      updateInfo();
    }

    // â¬‡ï¸ ë‚˜ë¨¸ì§€ëŠ” ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼, ì‚¬ìš©ì êµ¬ì¡°ì— shorts, longs ì¶”ê°€ë§Œ ë°˜ì˜
    // getCurrentUserData(), initCurrentUser(), updateRanking(), updateInfo() ë“±ì—
    // user.longs, user.shorts, longAvgPrice, shortAvgPrice ë°˜ì˜ë§Œ í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

    // (ì „ì²´ ì½”ë“œê°€ ë§¤ìš° ê¸¸ê¸° ë•Œë¬¸ì— ì—¬ê¸°ì— ìƒëµí–ˆì§€ë§Œ, ì›í•˜ì‹œë©´ ì „ì²´ í†µí•©ë³¸ì„ ë‹¤ì‹œ ì¶œë ¥í•´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)

  </script>
</body>
</html>
