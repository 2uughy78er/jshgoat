<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ëª¨ì˜ ì£¼ì‹ ì‹œë®¬ë ˆì´í„°</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
    .stock-info, .portfolio, .logs { margin-top: 20px; }
    .panel { margin-bottom: 10px; }
    textarea { width: 100%; height: 100px; }
    canvas { background: white; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>ğŸ“ˆ ëª¨ì˜ ì£¼ì‹ ì‹œë®¬ë ˆì´í„°</h1>  <div class="panel">
    <label>ì¢…ëª© ì„ íƒ: 
      <select id="stockSelect"></select>
    </label>
    <button onclick="buyStock()">ë§¤ìˆ˜</button>
    <button onclick="sellStock()">ë§¤ë„</button>
    <button onclick="shortStock()">ìˆ</button>
    <button onclick="coverShort()">ì²­ì‚°</button>
    <button onclick="resetAllData()" style="background: red; color: white;">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
  </div>  <div class="stock-info">
    <p>í˜„ì¬ ìì‚°: <span id="cash"></span>ì›</p>
    <p>í˜„ì¬ ìˆ˜ìµë¥ : <span id="roi"></span>%</p>
  </div>  <div class="portfolio">
    <h3>ë³´ìœ  ì¢…ëª©</h3>
    <ul id="portfolioList"></ul>
  </div>  <div class="logs">
    <h3>ê±°ë˜ ê¸°ë¡</h3>
    <textarea id="logArea" readonly></textarea>
  </div>  <div>
    <canvas id="stockChart" width="600" height="300"></canvas>
  </div>  <script>
    let cash = 100000;
    let portfolio = {};
    let logs = [];
    let prices = JSON.parse(localStorage.getItem('prices')) || {
      ì‚¼ì„±ì „ì: 60000, ì¹´ì¹´ì˜¤: 70000, ë„¤ì´ë²„: 80000, LGí™”í•™: 90000, SKí•˜ì´ë‹‰ìŠ¤: 100000
    };
    let initialPrices = { ...prices };
    let stocks = Object.entries(prices).map(([name, price]) => ({ name, price }));
    let currentStock = stocks[0].name;
    let chartsData = {};
    let chart;

    function saveAll() {
      localStorage.setItem('cash', cash);
      localStorage.setItem('portfolio', JSON.stringify(portfolio));
      localStorage.setItem('logs', JSON.stringify(logs));
      localStorage.setItem('prices', JSON.stringify(prices));
      localStorage.setItem('chartsData', JSON.stringify(chartsData));
    }

    function loadAll() {
      cash = Number(localStorage.getItem('cash')) || 100000;
      portfolio = JSON.parse(localStorage.getItem('portfolio')) || {};
      logs = JSON.parse(localStorage.getItem('logs')) || [];
      chartsData = JSON.parse(localStorage.getItem('chartsData')) || {};
    }

    function updatePrices() {
      for (let stock of stocks) {
        let change = stock.price * (Math.random() * 0.04 - 0.02);
        stock.price = Math.max(1000, stock.price + change);
        prices[stock.name] = Math.round(stock.price);

        if (!chartsData[stock.name]) chartsData[stock.name] = [];
        chartsData[stock.name].push(prices[stock.name]);
        if (chartsData[stock.name].length > 50) chartsData[stock.name].shift();
      }
      saveAll();
    }

    function renderChart(name) {
      const ctx = document.getElementById('stockChart').getContext('2d');
      const data = chartsData[name] || [];
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({ length: data.length }, (_, i) => i + 1),
          datasets: [{
            label: name,
            data: data,
            borderColor: 'blue',
            tension: 0.3,
            fill: false
          }]
        }
      });
    }

    function updateUI() {
      document.getElementById('cash').textContent = cash.toLocaleString();
      document.getElementById('portfolioList').innerHTML = Object.entries(portfolio).map(([name, { qty, short }]) => 
        `<li>${name}: ${qty || 0}ì£¼${short ? ` (ìˆ: ${short.qty} @ ${short.price})` : ''}</li>`
      ).join('');
      const totalValue = Object.entries(portfolio).reduce((sum, [name, { qty = 0, short = null }]) => {
        return sum + (qty * prices[name]) - (short ? short.qty * (short.price - prices[name]) : 0);
      }, 0);
      const roi = (((cash + totalValue - 100000) / 100000) * 100).toFixed(2);
      document.getElementById('roi').textContent = roi;
      document.getElementById('stockSelect').innerHTML = stocks.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
    }

    function logAction(msg) {
      logs.push(`[${new Date().toLocaleTimeString()}] ${msg}`);
      document.getElementById('logArea').value = logs.join("\n");
    }

    function buyStock() {
      const name = document.getElementById('stockSelect').value;
      const price = prices[name];
      if (cash >= price) {
        cash -= price;
        portfolio[name] = portfolio[name] || { qty: 0 };
        portfolio[name].qty += 1;
        logAction(`${name} 1ì£¼ ë§¤ìˆ˜ (${price}ì›)`);
        saveAll();
        updateUI();
      }
    }

    function sellStock() {
      const name = document.getElementById('stockSelect').value;
      const price = prices[name];
      if (portfolio[name]?.qty > 0) {
        portfolio[name].qty -= 1;
        cash += price;
        logAction(`${name} 1ì£¼ ë§¤ë„ (${price}ì›)`);
        saveAll();
        updateUI();
      }
    }

    function shortStock() {
      const name = document.getElementById('stockSelect').value;
      const price = prices[name];
      portfolio[name] = portfolio[name] || {};
      portfolio[name].short = portfolio[name].short || { qty: 0, price: 0 };
      portfolio[name].short.qty += 1;
      portfolio[name].short.price = price;
      cash += price;
      logAction(`${name} 1ì£¼ ìˆ (${price}ì›)`);
      saveAll();
      updateUI();
    }

    function coverShort() {
      const name = document.getElementById('stockSelect').value;
      const price = prices[name];
      const short = portfolio[name]?.short;
      if (short && short.qty > 0) {
        portfolio[name].short.qty -= 1;
        cash -= price;
        const profit = short.price - price;
        cash += profit;
        logAction(`${name} 1ì£¼ ì²­ì‚° (${price}ì›, ìˆ˜ìµ: ${profit}ì›)`);
        saveAll();
        updateUI();
      }
    }

    function resetAllData() {
      if (confirm("ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
        localStorage.clear();
        cash = 100000;
        portfolio = {};
        logs = [];
        prices = structuredClone(initialPrices);
        stocks = Object.entries(prices).map(([name, price]) => ({ name, price }));
        chartsData = {};
        currentStock = stocks[0].name;
        updatePrices();
        renderChart(currentStock);
        updateUI();
        document.getElementById('logArea').value = "";
        alert("ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }
    }

    // ì´ˆê¸°í™”
    loadAll();
    updatePrices();
    updateUI();
    setInterval(() => {
      updatePrices();
      updateUI();
      renderChart(document.getElementById('stockSelect').value);
    }, 3000);
  </script></body>
</html>
