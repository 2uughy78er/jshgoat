<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ëª¨ì˜ ì£¼ì‹ ì‹œë®¬ë ˆì´í„°</title>
  <style>
    body { font-family: Arial; background: #f5f5f5; padding: 20px; }
    .stock { margin-bottom: 10px; padding: 10px; background: white; border-radius: 8px; box-shadow: 0 0 5px #ccc; }
    .buttons button { margin-right: 5px; }
    #portfolio, #history { margin-top: 30px; }
  </style>
</head>
<body>
  <h1>ğŸ“ˆ ëª¨ì˜ ì£¼ì‹ ì‹œë®¬ë ˆì´í„°</h1>
  <div id="stocks"></div>

  <h2>ğŸ’¼ ë‚´ í¬íŠ¸í´ë¦¬ì˜¤</h2>
  <div id="portfolio"></div>

  <h2>ğŸ“œ ê±°ë˜ ì´ë ¥</h2>
  <div id="history"></div>

  <script>
    const stocks = [
      { name: 'ì‚¼ì„±ì „ì', price: 72000 },
      { name: 'LGí™”í•™', price: 540000 },
      { name: 'NAVER', price: 205000 },
      { name: 'ì¹´ì¹´ì˜¤', price: 62000 },
      { name: 'í˜„ëŒ€ì°¨', price: 192000 },
      { name: 'ì…€íŠ¸ë¦¬ì˜¨', price: 142000 },
      { name: 'í•œí™”ì†”ë£¨ì…˜', price: 50000 },
      { name: 'SKí•˜ì´ë‹‰ìŠ¤', price: 126000 },
      { name: 'í¬ìŠ¤ì½”í“¨ì²˜ì— ', price: 310000 },
      { name: 'ëŒ€í•œí•­ê³µ', price: 25000 },
      { name: 'ë‘ì‚°ì—ë„ˆë¹Œë¦¬í‹°', price: 18000 },
      { name: 'ë¡¯ë°ì¼€ë¯¸ì¹¼', price: 190000 },
      { name: 'í•˜ë‚˜ê¸ˆìœµì§€ì£¼', price: 40000 },
      { name: 'ì‹ í•œì§€ì£¼', price: 37000 },
      { name: 'ì €ê°€ì£¼1000', price: 1000 }
    ];

    const updateInterval = 5000;
    let state = {
      cash: 100000,
      prices: {},
      holdings: {},
      shorts: {},
      trades: []
    };

    function formatNumber(num) {
      return num.toLocaleString();
    }

    function saveState() {
      localStorage.setItem('simState', JSON.stringify(state));
    }

    function loadState() {
      const data = localStorage.getItem('simState');
      if (data) state = JSON.parse(data);
      else stocks.forEach(s => state.prices[s.name] = s.price);
    }

    function renderStocks() {
      const container = document.getElementById('stocks');
      container.innerHTML = '';
      stocks.forEach(stock => {
        const price = state.prices[stock.name];
        const div = document.createElement('div');
        div.className = 'stock';
        div.innerHTML = `
          <strong>${stock.name}</strong> - ${formatNumber(price)}ì›
          <div class="buttons">
            <button onclick="buy('${stock.name}')">ë§¤ìˆ˜</button>
            <button onclick="sell('${stock.name}')">ë§¤ë„</button>
            <button onclick="shortSell('${stock.name}')">ê³µë§¤ë„</button>
            <button onclick="coverShort('${stock.name}')">ìˆì²­ì‚°</button>
          </div>`;
        container.appendChild(div);
      });
    }

    function renderPortfolio() {
      const container = document.getElementById('portfolio');
      let html = `í˜„ê¸ˆ: ${formatNumber(state.cash)}ì›<br>`;
      html += `<table><tr><th>ì¢…ëª©</th><th>ë³´ìœ </th><th>ê³µë§¤ë„</th><th>ìˆ˜ìµë¥ </th></tr>`;
      stocks.forEach(stock => {
        const name = stock.name;
        const h = state.holdings[name];
        const s = state.shorts[name];
        if (h || s) {
          let pct = '';
          if (h) {
            const avg = h.totalCost / h.qty;
            const now = state.prices[name];
            pct = (((now - avg) / avg) * 100).toFixed(1) + '%';
          } else if (s) {
            const avg = s.totalProceeds / s.qty;
            const now = state.prices[name];
            pct = (((avg - now) / avg) * 100).toFixed(1) + '%';
          }
          html += `<tr><td>${name}</td><td>${h ? h.qty : 0}</td><td>${s ? s.qty : 0}</td><td>${pct}</td></tr>`;
        }
      });
      html += `</table>`;
      container.innerHTML = html;
    }

    function buy(name) {
      const price = state.prices[name];
      if (state.cash >= price) {
        state.cash -= price;
        if (!state.holdings[name]) state.holdings[name] = { qty: 0, totalCost: 0 };
        state.holdings[name].qty++;
        state.holdings[name].totalCost += price;
        recordTrade('ë§¤ìˆ˜', name, price);
        renderPortfolio(); saveState();
      }
    }

    function sell(name) {
      const h = state.holdings[name];
      if (h && h.qty > 0) {
        const price = state.prices[name];
        const avg = h.totalCost / h.qty;
        const profit = price - avg;
        state.cash += price;
        h.totalCost -= avg;
        h.qty--;
        if (h.qty === 0) delete state.holdings[name];
        recordTrade('ë§¤ë„', name, price, profit);
        renderPortfolio(); saveState();
      }
    }

    function shortSell(name) {
      const price = state.prices[name];
      if (!state.shorts[name]) state.shorts[name] = { qty: 0, totalProceeds: 0 };
      state.shorts[name].qty++;
      state.shorts[name].totalProceeds += price;
      state.cash += price;
      recordTrade('ìˆ(ê³µë§¤ë„)', name, price);
      renderPortfolio(); saveState();
    }

    function coverShort(name) {
      const s = state.shorts[name];
      if (s && s.qty > 0) {
        const price = state.prices[name];
        const avg = s.totalProceeds / s.qty;
        const profit = avg - price;
        state.cash -= price;
        s.totalProceeds -= avg;
        s.qty--;
        if (s.qty === 0) delete state.shorts[name];
        recordTrade('ìˆì²­ì‚°', name, price, profit);
        renderPortfolio(); saveState();
      }
    }

    function updatePrices() {
      stocks.forEach(stock => {
        const change = (Math.random() * 10 - 5) | 0;
        state.prices[stock.name] = Math.max(100, state.prices[stock.name] + change);
      });
      renderStocks(); renderPortfolio(); saveState();
    }

    function crashRandomStock() {
      const target = stocks[Math.floor(Math.random() * stocks.length)].name;
      const drop = 0.7 + Math.random() * 0.3;
      state.prices[target] = Math.floor(state.prices[target] * (1 - drop));
      recordTrade('ğŸ”¥ í­ë½ ë°œìƒ', target, state.prices[target]);
      renderStocks(); renderPortfolio(); saveState();
    }

    function boomRandomStock() {
      const target = stocks[Math.floor(Math.random() * stocks.length)].name;
      const up = 1 + Math.random() * 0.2;
      state.prices[target] = Math.floor(state.prices[target] * up);
      recordTrade('ğŸš€ í­ë“± ë°œìƒ', target, state.prices[target]);
      renderStocks(); renderPortfolio(); saveState();
    }

    function recordTrade(type, name, price, result = null) {
      const now = new Date().toLocaleTimeString();
      let text = `[${now}] ${type} - ${name} @ ${formatNumber(price)}ì›`;
      if (result !== null) {
        const percent = ((result / price) * 100).toFixed(2);
        text += ` | ì†ìµ: ${formatNumber(result)}ì› (${percent}%)`;
      }
      state.trades.push(text);
      updateHistory(); saveState();
    }

    function updateHistory() {
      const el = document.getElementById('history');
      el.innerHTML = state.trades.slice().reverse().map(t => `<div>${t}</div>`).join('');
    }

    loadState();
    renderStocks();
    renderPortfolio();
    updateHistory();
    setInterval(updatePrices, updateInterval);
    setInterval(crashRandomStock, 100000);
    setInterval(boomRandomStock, 150000);
  </script>
</body>
</html>
