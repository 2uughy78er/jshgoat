<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>주식 시뮬레이터</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; display: flex; flex-direction: column; align-items: center; }
    #market, #portfolio, #holdings { display: flex; flex-wrap: wrap; margin: 10px; }
    .stock, .portfolio-entry, .holding { border: 1px solid #ccc; border-radius: 8px; padding: 10px; margin: 5px; width: 200px; }
    #chart-container { width: 100%; max-width: 800px; }
    .highlight { font-weight: bold; }
  </style>
</head>
<body>
  <h1>주식 시뮬레이터</h1>
  <label>이름: <input type="text" id="playerName" /></label>
  <button onclick="saveName()">이름 설정</button>
  <div id="funds">자금: 100000원</div>
  <div id="market"></div>
  <div id="portfolio"></div>
  <div id="holdings"></div>
  <div id="chart-container">
    <canvas id="stockChart"></canvas>
  </div>
  <div id="ranking"></div>
  <script>
    const INITIAL_FUNDS = 100000;
    const MAX_POINTS = 50;
    let playerName = localStorage.getItem('playerName') || '';
    document.getElementById('playerName').value = playerName;const stocks = {
  "삼성전자": 70000, "LG전자": 80000, "네이버": 120000,
  "카카오": 90000, "현대차": 130000, "기아": 85000,
  "셀트리온": 95000, "POSCO": 110000, "한화솔루션": 78000,
  "SK하이닉스": 105000, "대한항공": 60000, "아모레퍼시픽": 93000,
  "롯데케미칼": 70000, "GS건설": 62000, "한샘": 51000,
  "천원주": 1000
};

const holdings = JSON.parse(localStorage.getItem('holdings') || '{}');
let funds = parseInt(localStorage.getItem('funds') || INITIAL_FUNDS);

function saveName() {
  playerName = document.getElementById('playerName').value;
  localStorage.setItem('playerName', playerName);
  updateRanking();
}

function updateMarket() {
  const market = document.getElementById('market');
  market.innerHTML = '';
  for (const [name, price] of Object.entries(stocks)) {
    const el = document.createElement('div');
    el.className = 'stock';
    el.innerHTML = `<div>${name}: ${price}원</div>
      <button onclick="buy('${name}')">매수</button>
      <button onclick="sell('${name}')">매도</button>
      <button onclick="shortSell('${name}')">공매도</button>
      <button onclick="coverShort('${name}')">쇼트청산</button>`;
    market.appendChild(el);
  }
}

function updatePortfolio() {
  document.getElementById('funds').innerText = `자금: ${funds}원`;
  const portfolio = document.getElementById('portfolio');
  const holdingDisplay = document.getElementById('holdings');
  portfolio.innerHTML = '<h3>포트폴리오</h3>';
  holdingDisplay.innerHTML = '<h3>보유량</h3>';
  for (const name in stocks) {
    const amount = holdings[name]?.amount || 0;
    const short = holdings[name]?.short || 0;
    if (amount || short) {
      const el = document.createElement('div');
      el.className = 'portfolio-entry';
      el.innerText = `${name} - 매수: ${amount} / 공매도: ${short}`;
      portfolio.appendChild(el);
    }
    const elHold = document.createElement('div');
    elHold.className = 'holding';
    elHold.innerText = `${name}: ${amount}`;
    holdingDisplay.appendChild(elHold);
  }
  localStorage.setItem('funds', funds);
  localStorage.setItem('holdings', JSON.stringify(holdings));
}

function buy(name) {
  if (funds >= stocks[name]) {
    funds -= stocks[name];
    holdings[name] = holdings[name] || { amount: 0, short: 0 };
    holdings[name].amount++;
    updatePortfolio();
  }
}

function sell(name) {
  if (holdings[name]?.amount > 0) {
    holdings[name].amount--;
    funds += stocks[name];
    updatePortfolio();
  }
}

function shortSell(name) {
  holdings[name] = holdings[name] || { amount: 0, short: 0 };
  holdings[name].short++;
  funds += stocks[name];
  updatePortfolio();
}

function coverShort(name) {
  if (holdings[name]?.short > 0 && funds >= stocks[name]) {
    holdings[name].short--;
    funds -= stocks[name];
    updatePortfolio();
  }
}

let chartData = {
  labels: [],
  datasets: Object.keys(stocks).map((name, i) => ({
    label: name,
    data: [],
    borderColor: `hsl(${i * 24}, 70%, 50%)`,
    fill: false,
    hidden: true
  }))
};

const ctx = document.getElementById('stockChart').getContext('2d');
const stockChart = new Chart(ctx, {
  type: 'line',
  data: chartData,
  options: { responsive: true, scales: { y: { beginAtZero: false } } }
});

function updateChart() {
  const now = new Date().toLocaleTimeString();
  if (chartData.labels.length >= MAX_POINTS) {
    chartData.labels.shift();
    chartData.datasets.forEach(ds => ds.data.shift());
  }
  chartData.labels.push(now);
  chartData.datasets.forEach(ds => {
    ds.data.push(stocks[ds.label]);
  });
  stockChart.update();
}

function randomFluctuation() {
  for (const name in stocks) {
    let change = Math.random() * 2 - 1;
    stocks[name] = Math.max(1, Math.floor(stocks[name] * (1 + change * 0.01)));
  }
  updateMarket();
  updatePortfolio();
  updateChart();
}

function crashAll() {
  for (const name in stocks) {
    stocks[name] = Math.max(1, Math.floor(stocks[name] * 0.5));
  }
  updateMarket(); updatePortfolio(); updateChart();
}

function boomAll() {
  for (const name in stocks) {
    stocks[name] = Math.floor(stocks[name] * 2.2);
  }
  updateMarket(); updatePortfolio(); updateChart();
}

function updateRanking() {
  const score = Object.keys(holdings).reduce((sum, name) => {
    const h = holdings[name];
    return sum + (h.amount - h.short) * stocks[name];
  }, funds);
  const rankData = JSON.parse(localStorage.getItem('rankData') || '[]');
  const existing = rankData.find(r => r.name === playerName);
  if (existing) existing.score = score;
  else rankData.push({ name: playerName, score });
  rankData.sort((a, b) => b.score - a.score);
  localStorage.setItem('rankData', JSON.stringify(rankData));

  const rankDiv = document.getElementById('ranking');
  rankDiv.innerHTML = '<h3>수익률 랭킹</h3>' + rankData.map(r => `<div>${r.name}: ${r.score}원</div>`).join('');
}

setInterval(randomFluctuation, 1000);
setInterval(crashAll, 100000);
setInterval(boomAll, 150000);
setInterval(updateRanking, 5000);

updateMarket();
updatePortfolio();
updateChart();

  </script>
</body>
</html>
