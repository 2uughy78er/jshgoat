<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì˜¨ë¼ì¸ ë°”ì¹´ë¼</title>
<style>
    body { font-family: Arial; background: #006400; color: #fff; text-align: center; margin: 0; padding: 0; }
    .table { width: 90%; margin: 20px auto; background: #0a3d0a; border-radius: 10px; padding: 20px; }
    .cards { display: flex; justify-content: center; margin: 10px 0; }
    .hand { margin: 0 20px; }
    .card { width: 60px; height: 90px; border-radius: 5px; background: white; color: black; font-weight: bold;
            display: flex; align-items: center; justify-content: center; margin: 0 5px; }
    .chip-container { margin: 10px 0; }
    .chip { display: inline-block; width: 60px; height: 60px; border-radius: 50%; background: gold; color: black;
            line-height: 60px; font-weight: bold; margin: 5px; cursor: pointer; user-select: none; }
    .chip:hover { transform: scale(1.2); }
    button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; }
    .info { margin: 10px 0; font-size: 18px; }
    .history { margin-top: 15px; }
    .history span { display: inline-block; width: 50px; height: 30px; line-height: 30px; border-radius: 5px; margin: 0 2px; }
    .PLAYER { background: blue; }
    .BANKER { background: red; }
    .TIE { background: green; }
</style>
</head>
<body>

<div class="table">
    <div class="info" id="money">ë³´ìœ ê¸ˆì•¡: 10000ì›</div>
    <div class="info" id="countdown">ë°°íŒ… ì œí•œì‹œê°„: 10ì´ˆ</div>
    
    <div>
        <label><input type="radio" name="target" value="PLAYER" checked> PLAYER</label>
        <label><input type="radio" name="target" value="BANKER"> BANKER</label>
        <label><input type="radio" name="target" value="TIE"> TIE</label>
    </div>

    <div class="chip-container">
        <div class="chip" data-value="500">500</div>
        <div class="chip" data-value="1000">1000</div>
        <div class="chip" data-value="5000">5000</div>
        <div class="chip" data-value="10000">10000</div>
    </div>

    <div class="info" id="bet">í˜„ì¬ ë² íŒ…: 0ì›</div>

    <div class="cards">
        <div class="hand">
            <div>PLAYER</div>
            <div id="player-cards" style="display:flex"></div>
            <div id="player-score"></div>
        </div>
        <div class="hand">
            <div>BANKER</div>
            <div id="banker-cards" style="display:flex"></div>
            <div id="banker-score"></div>
        </div>
    </div>

    <div class="info" id="result"></div>
    <button id="startBtn">ë”œ ì‹œì‘</button>
    
    <div class="history" id="history">íˆìŠ¤í† ë¦¬:</div>
</div>

<script>
let money = 10000;
let bet = 0;
let target = 'PLAYER';
let deck = [];
let playerHand = [];
let bankerHand = [];
let history = [];
let countdown = 10;
let timer;

function createDeck() {
    const suits = ["â™ ", "â™¥", "â™£", "â™¦"];
    const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    let d = [];
    for(let s of suits){
        for(let r of ranks){
            d.push({suit:s, rank:r});
        }
    }
    return shuffle(d);
}

function shuffle(array) {
    for(let i=array.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [array[i], array[j]]=[array[j], array[i]];
    }
    return array;
}

function cardValue(rank){
    if(rank==="A") return 1;
    if(["10","J","Q","K"].includes(rank)) return 0;
    return parseInt(rank);
}

function baccaratScore(hand){
    let total = hand.reduce((sum,c)=>sum+cardValue(c.rank),0);
    return total%10;
}

function bankerDrawRule(bScore,pThird){
    if(!pThird) return bScore<=5;
    let pt = cardValue(pThird.rank);
    if(bScore<=2) return true;
    if(bScore===3 && pt!==8) return true;
    if(bScore===4 && [2,3,4,5,6,7].includes(pt)) return true;
    if(bScore===5 && [4,5,6,7].includes(pt)) return true;
    if(bScore===6 && [6,7].includes(pt)) return true;
    return false;
}

// ---------------------------
function updateUI(){
    document.getElementById("money").innerText=`ë³´ìœ ê¸ˆì•¡: ${money}ì›`;
    document.getElementById("bet").innerText=`í˜„ì¬ ë² íŒ…: ${bet}ì›`;
    document.querySelectorAll('input[name="target"]').forEach(r=>{
        if(r.checked) target = r.value;
    });
}

function addBet(val){
    if(bet+val>money){alert("ë³´ìœ ê¸ˆì•¡ ì´ˆê³¼!"); return;}
    bet += val;
    updateUI();
}

document.querySelectorAll(".chip").forEach(c=>{
    c.addEventListener("click",()=> addBet(Number(c.dataset.value)));
});

document.getElementById("startBtn").addEventListener("click",()=>startRound());

function startCountdown(){
    countdown=10;
    document.getElementById("countdown").innerText=`ë°°íŒ… ì œí•œì‹œê°„: ${countdown}ì´ˆ`;
    timer = setInterval(()=>{
        countdown--;
        if(countdown<=0){
            clearInterval(timer);
            document.getElementById("countdown").innerText="ì‹œê°„ ì¢…ë£Œ! ìë™ ê²Œì„ ì‹œì‘";
            startRound();
        } else {
            document.getElementById("countdown").innerText=`ë°°íŒ… ì œí•œì‹œê°„: ${countdown}ì´ˆ`;
        }
    },1000);
}

function startRound(){
    if(bet<500){bet = Math.min(500,money);}
    if(bet>money) bet=money;
    money -= bet;
    updateUI();
    clearInterval(timer);

    deck=createDeck();
    playerHand=[]; bankerHand=[];
    document.getElementById("player-cards").innerHTML="";
    document.getElementById("banker-cards").innerHTML="";
    document.getElementById("player-score").innerText="";
    document.getElementById("banker-score").innerText="";
    document.getElementById("result").innerText="";

    dealInitialCards();
}

async function dealInitialCards(){
    await revealCard('player', playerHand, deck.pop());
    await revealCard('banker', bankerHand, deck.pop());
    await revealCard('player', playerHand, deck.pop());
    await revealCard('banker', bankerHand, deck.pop());
    drawRules();
}

function sleep(ms){return new Promise(resolve=>setTimeout(resolve,ms));}

async function revealCard(handType, hand, card){
    hand.push(card);
    let container=document.getElementById(handType+"-cards");
    let div=document.createElement("div");
    div.className="card";
    div.innerText=`${card.suit}${card.rank}`;
    container.appendChild(div);
    if(handType==="player")
        document.getElementById("player-score").innerText=`ì ìˆ˜: ${baccaratScore(hand)}`;
    else
        document.getElementById("banker-score").innerText=`ì ìˆ˜: ${baccaratScore(hand)}`;
    await sleep(500);
}

async function drawRules(){
    let pScore = baccaratScore(playerHand);
    let bScore = baccaratScore(bankerHand);
    if(pScore>=8 || bScore>=8){finishRound(); return;}
    let pThird = null;
    if(pScore<=5){
        pThird = deck.pop();
        await revealCard('player',playerHand,pThird);
    }
    if(bankerDrawRule(bScore,pThird)){
        let bThird = deck.pop();
        await revealCard('banker',bankerHand,bThird);
    }
    finishRound();
}

function finishRound(){
    let pScore=baccaratScore(playerHand);
    let bScore=baccaratScore(bankerHand);
    let winner;
    if(pScore>bScore) winner="PLAYER";
    else if(bScore>pScore) winner="BANKER";
    else winner="TIE";

    let winAmount =0;
    if(winner===target){
        if(winner==="PLAYER") winAmount=bet*2;
        else if(winner==="BANKER") winAmount=Math.floor(bet*1.95);
        else winAmount=bet*8;
        money+=winAmount;
        document.getElementById("result").innerText=`${winner} ìŠ¹ë¦¬! +${winAmount-bet}ì›`;
    } else document.getElementById("result").innerText=`${winner} ìŠ¹ë¦¬! ë² íŒ… ì‹¤íŒ¨!`;

    history.push(winner);
    if(history.length>10) history.shift();
    document.getElementById("history").innerHTML="íˆìŠ¤í† ë¦¬: "+history.map(h=>`<span class="${h}">${h}</span>`).join(" ");

    bet=0;
    updateUI();
    startCountdown();
}

// ìµœì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
startCountdown();

</script>
</body>
</html>      font-size: 1.8em;
      margin: 0;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .top-bar button {
      background: #555;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

    .top-bar button:hover {
      background: #333;
    }

    .panel {
      background: var(--panel-color);
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .panel h3 {
      margin-top: 0;
    }

    #stockChart {
      width: 100%;
      height: 300px;
    }

    textarea {
      width: 100%;
      height: 120px;
      background: #f1f1f1;
      border: none;
      padding: 10px;
      border-radius: 8px;
      resize: none;
      font-size: 14px;
    }

    .dark textarea {
      background: #444;
      color: #eee;
    }

    button {
      cursor: pointer;
      padding: 8px 14px;
      margin: 4px 2px;
      border-radius: 6px;
      border: none;
      background-color: var(--primary-color);
      color: white;
      font-size: 14px;
    }

    button:hover {
      background-color: var(--hover-color);
    }

    .reset-button {
      background: var(--danger-color);
    }

    select, input {
      padding: 7px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-right: 8px;
      font-size: 14px;
    }

    .dark select, .dark input {
      background: #444;
      color: #eee;
      border: 1px solid #666;
    }

    #stockInfo > div {
      margin: 6px 0;
      padding: 6px 8px;
      border-bottom: 1px solid #eee;
      font-size: 14px;
    }

    .dark #stockInfo > div {
      border-color: #444;
    }

    #stockInfo {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 10px;
    }

    #stockInfo b {
      display: inline-block;
      min-width: 100px;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1>ğŸ“ˆ ëª¨ì˜ ì£¼ì‹ ì‹œë®¬ë ˆì´í„°</h1>
    <button onclick="toggleDarkMode()">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
  </div>

  <div class="panel">
    ğŸ’° ìì‚°: <span id="cash"></span>ì› |
    ì´ í‰ê°€ê¸ˆì•¡: <span id="totalValue"></span>ì› |
    ìˆ˜ìµë¥ : <span id="roi"></span>%
  </div>

  <div class="panel">
    <label for="stockSelect">ì¢…ëª© ì„ íƒ:</label>
    <select id="stockSelect"></select>
    <input type="number" id="amount" value="1" min="1">
    <button onclick="buyStock()">ë§¤ìˆ˜</button>
    <button onclick="sellStock()">ë§¤ë„</button>
    <button onclick="shortSell()">ìˆ ì§„ì…</button>
    <button onclick="shortCover()">ìˆ ë§¤ë„</button>
  </div>

  <div class="panel" id="stockInfo"></div>

  <div class="panel">
    <canvas id="stockChart"></canvas>
  </div>

  <div class="panel">
    <h3>ğŸ“˜ ê±°ë˜ ë¡œê·¸</h3>
    <textarea id="logArea" readonly></textarea>
  </div>

  <div class="panel">
    <button onclick="resetAllData()" style="background: red;">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
  </div>

  <script>
    const initialPrices = {
      'ì‚¼ì„±ì „ì': 70000,
      'í˜„ëŒ€ì°¨': 180000,
      'LGì—ë„ˆì§€ì†”ë£¨ì…˜': 400000,
      'ì¹´ì¹´ì˜¤': 60000,
      'ë„¤ì´ë²„': 200000,
      'SKí•˜ì´ë‹‰ìŠ¤': 130000,
      'ì‚¼ì„±SDI': 600000,
      'POSCO': 350000,
      'í•œí™”ì†”ë£¨ì…˜': 50000,
      'ì…€íŠ¸ë¦¬ì˜¨': 160000,
      'ì”¨ì  ': 30000,
      'ë‘ì‚°ì—ë„ˆë¹Œë¦¬í‹°': 25000,
      'HMM': 15000,
      'íŒ¬ì˜¤ì…˜': 10000,
      'í•œêµ­ì „ë ¥': 1000
    };

    let prices = JSON.parse(localStorage.getItem('stockPrices')) || structuredClone(initialPrices);
    let stocks = Object.entries(prices).map(([name, price]) => ({ name, price }));
    let portfolio = JSON.parse(localStorage.getItem('portfolio')) || {};
    let cash = parseInt(localStorage.getItem('cash') || "100000");
    let logs = JSON.parse(localStorage.getItem('logs')) || [];
    let currentStock = stocks[0].name;
    let chartsData = {};
    let currentChart = null;

    function saveAll() {
      localStorage.setItem('portfolio', JSON.stringify(portfolio));
      localStorage.setItem('cash', cash);
      localStorage.setItem('logs', JSON.stringify(logs));
      const updatedPrices = {};
      stocks.forEach(s => updatedPrices[s.name] = s.price);
      localStorage.setItem('stockPrices', JSON.stringify(updatedPrices));
    }

    function updateUI() {
  document.getElementById('cash').textContent = cash.toLocaleString();
  let total = cash;
  const info = stocks.map(s => {
    const p = portfolio[s.name] || { quantity: 0, short: 0, shortPrice: 0, logs: [] };
    const holdingValue = p.quantity * s.price;
    const shortProfit = p.short > 0 ? (p.shortPrice - s.price) * p.short : 0;
    total += holdingValue + shortProfit;

    // í‰ê·  ë§¤ìˆ˜ ê°€ê²© ê³„ì‚°
    const buyLogs = (p.logs || []).filter(l => l.action === "buy");
    const totalBuyCost = buyLogs.reduce((sum, l) => sum + l.price, 0);
    const avgBuyPrice = buyLogs.length > 0 ? Math.round(totalBuyCost / buyLogs.length) : 0;

    // ìˆ˜ìµë¥  ê³„ì‚°
    let roiText = "";
    if (p.quantity > 0 && avgBuyPrice > 0) {
      const roi = (((s.price - avgBuyPrice) / avgBuyPrice) * 100).toFixed(2);
      roiText = ` | ìˆ˜ìµë¥ : ${roi}%`;
    }

    return `<div><b>${s.name}</b> | í˜„ì¬ê°€: ${s.price.toLocaleString()}ì› | ë³´ìœ : ${p.quantity}ì£¼ @${avgBuyPrice}ì›${roiText} | ìˆ: ${p.short}ì£¼ @${p.shortPrice || 0} | ìˆì´ìµ: ${shortProfit.toLocaleString()}ì›</div>`;
  }).join('');
  document.getElementById('stockInfo').innerHTML = info;
  const roi = (((total - 100000) / 100000) * 100).toFixed(2);
  document.getElementById('totalValue').textContent = total.toLocaleString();
  document.getElementById('roi').textContent = roi;
}


    function logAction(msg) {
      logs.push(`[${new Date().toLocaleTimeString()}] ${msg}`);
      document.getElementById('logArea').value = logs.slice(-100).join('\n');
      saveAll();
    }

    function buyStock() {
      const stock = stocks.find(s => s.name === currentStock);
      const amount = parseInt(document.getElementById('amount').value);
      const cost = stock.price * amount;
      if (cash >= cost) {
        cash -= cost;
        if (!portfolio[currentStock]) portfolio[currentStock] = { quantity: 0, short: 0, shortPrice: 0, logs: [] };
        portfolio[currentStock].quantity += amount;
        portfolio[currentStock].logs.push({ action: "buy", price: stock.price });
        logAction(`${currentStock} ${amount}ì£¼ ë§¤ìˆ˜ @${stock.price}`);
        updateUI();
      }
    }

    function sellStock() {
      const stock = stocks.find(s => s.name === currentStock);
      const amount = parseInt(document.getElementById('amount').value);
      const p = portfolio[currentStock];
      if (p && p.quantity >= amount) {
        cash += stock.price * amount;
        p.quantity -= amount;
        p.logs.push({ action: "sell", price: stock.price });
        logAction(`${currentStock} ${amount}ì£¼ ë§¤ë„ @${stock.price}`);
        updateUI();
      }
    }

    function shortSell() {
      const stock = stocks.find(s => s.name === currentStock);
      const amount = parseInt(document.getElementById('amount').value);
      const cost = stock.price * amount;
      if (cash >= cost) {
        cash -= cost;
        if (!portfolio[currentStock]) portfolio[currentStock] = { quantity: 0, short: 0, shortPrice: 0, logs: [] };
        portfolio[currentStock].short += amount;
        portfolio[currentStock].shortPrice = stock.price;
        portfolio[currentStock].logs.push({ action: "short", price: stock.price });
        logAction(`${currentStock} ${amount}ì£¼ ìˆ ì§„ì… @${stock.price}`);
        updateUI();
      }
    }

    function shortCover() {
      const stock = stocks.find(s => s.name === currentStock);
      const amount = parseInt(document.getElementById('amount').value);
      const p = portfolio[currentStock];
      if (p && p.short >= amount) {
        const gain = (p.shortPrice - stock.price) * amount;
        cash += stock.price * amount + gain;
        p.short -= amount;
        if (p.short === 0) p.shortPrice = 0;
        p.logs.push({ action: "cover", price: stock.price });
        logAction(`${currentStock} ${amount}ì£¼ ìˆ ë§¤ë„ (ì²­ì‚°) @${stock.price} | ì´ìµ: ${gain}`);
        updateUI();
      }
    }

    function updatePrices() {
      stocks.forEach(s => {
        const delta = (Math.random() - 0.45) * 0.1;
        s.price = Math.max(1, Math.round(s.price * (1 + delta)));
      });
      saveAll();
    }

    function applyCrash() {
      const s = stocks[Math.floor(Math.random() * stocks.length)];
      const drop = Math.random() * 0.3 + 0.7;
      s.price = Math.max(1, Math.floor(s.price * (1 - drop)));
      logAction(`ğŸ’¥ ${s.name} í­ë½ (-${Math.floor(drop * 100)}%)`);
    }

    function applyBoom() {
      const s = stocks[Math.floor(Math.random() * stocks.length)];
      const rise = Math.random() * 0.2 + 1;
      s.price = Math.floor(s.price * (1 + rise));
      logAction(`ğŸš€ ${s.name} í­ë“± (+${Math.floor(rise * 100)}%)`);
    }

    function renderChart(name) {
      if (currentChart) currentChart.destroy();
      const ctx = document.getElementById('stockChart').getContext('2d');
      const data = chartsData[name];
      currentChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: name,
            data: data.data,
            borderColor: 'skyblue',
            fill: false
          }]
        },
        options: { animation: false, scales: { y: { beginAtZero: false } } }
      });
    }

    function initCharts() {
      stocks.forEach(s => chartsData[s.name] = { labels: [], data: [] });
    }

    function updateChartData() {
      const time = new Date().toLocaleTimeString();
      stocks.forEach(s => {
        const d = chartsData[s.name];
        d.labels.push(time);
        d.data.push(s.price);
        if (d.labels.length > 50) {
          d.labels.shift();
          d.data.shift();
        }
      });
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
    }

    function resetAllData() {
      if (confirm("ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        localStorage.clear();
        location.reload();
      }
    }

    document.getElementById('stockSelect').addEventListener('change', e => {
      currentStock = e.target.value;
      renderChart(currentStock);
    });

    function init() {
      const select = document.getElementById('stockSelect');
      stocks.forEach(s => {
        const o = document.createElement('option');
        o.value = s.name;
        o.textContent = s.name;
        select.appendChild(o);
      });
      initCharts();
      updateChartData();
      renderChart(currentStock);
      updateUI();
      document.getElementById('logArea').value = logs.slice(-100).join('\n');
    }

    setInterval(() => {
      updatePrices();
      updateChartData();
      renderChart(currentStock);
      updateUI();
    }, 3000);

    setInterval(applyCrash, 100000);
    setInterval(applyBoom, 150000);

    init();
  </script>
</body>
</html>

